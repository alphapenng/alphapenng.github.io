<!doctype html><html lang=zh-cn itemscope itemtype=http://schema.org/WebPage><head><meta name=generator content="Hugo 0.110.0"><meta charset=utf-8><title>OmniEdge 异地组网部署 · 寂寞留白</title><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><script async defer data-website-id=058488c2-18d4-498a-b683-0a898b3f6c7a src=https://data.pseudoyu.com/pseudoyu.js></script>
<script async src=https://cdn.splitbee.io/sb.js></script>
<script src=https://cdn.splitbee.io/sb-ab.js></script><meta name=description content="OmniEdge 是什么？ 打开 OmniEdge的官网 https://omniedge.io/ 可以看到它的 slogan： 连接任何设备到局域网。 使用 OmniEdge 的下一代异地组网 Mesh VPN，将局域网架设到网上，将"><meta name=keywords content="geek,develop,network,programming"><link rel=canonical href=https://alphapenng.github.io/zh-cn/2022/12/31/omniedge-%E5%BC%82%E5%9C%B0%E7%BB%84%E7%BD%91%E9%83%A8%E7%BD%B2/><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css integrity=sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css integrity=sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ crossorigin=anonymous><link rel=stylesheet href=https://alphapenng.github.io/css/den.css><meta property="og:title" content="OmniEdge 异地组网部署"><meta property="og:description" content="OmniEdge 是什么？ 打开 OmniEdge的官网 https://omniedge.io/ 可以看到它的 slogan： 连接任何设备到局域网。 使用 OmniEdge 的下一代异地组网 Mesh VPN，将局域网架设到网上，将"><meta property="og:type" content="article"><meta property="og:url" content="https://alphapenng.github.io/zh-cn/2022/12/31/omniedge-%E5%BC%82%E5%9C%B0%E7%BB%84%E7%BD%91%E9%83%A8%E7%BD%B2/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-31T22:53:24+08:00"><meta property="article:modified_time" content="2022-12-31T22:53:24+08:00"><meta itemprop=name content="OmniEdge 异地组网部署"><meta itemprop=description content="OmniEdge 是什么？ 打开 OmniEdge的官网 https://omniedge.io/ 可以看到它的 slogan： 连接任何设备到局域网。 使用 OmniEdge 的下一代异地组网 Mesh VPN，将局域网架设到网上，将"><meta itemprop=datePublished content="2022-12-31T22:53:24+08:00"><meta itemprop=dateModified content="2022-12-31T22:53:24+08:00"><meta itemprop=wordCount content="1613"><meta itemprop=keywords content="geek,homelab,omniedge,vpn,"><meta name=twitter:card content="summary"><meta name=twitter:title content="OmniEdge 异地组网部署"><meta name=twitter:description content="OmniEdge 是什么？ 打开 OmniEdge的官网 https://omniedge.io/ 可以看到它的 slogan： 连接任何设备到局域网。 使用 OmniEdge 的下一代异地组网 Mesh VPN，将局域网架设到网上，将"></head><body><div class=header-container style=background:linear-gradient(rgba(0,0,0,.2),rgba(0,0,0,.2)),url(https://alphapenng.github.io/images/background.jpg);background-position:50%;background-size:cover><div class=container><nav class="header-nav navbar navbar-expand-md navbar-dark light-dark"><div class="header-logo navbar-brand"><a class=float-left href=https://alphapenng.github.io/zh-cn/><img class="mr20 header-logo-image" src=https://alphapenng.github.io/images/avatar72.png alt=logo>
alphapenng</a></div><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="nav-menu collapse navbar-collapse" id=navbarNav><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://alphapenng.github.io/zh-cn/category/network/>网络</a></li><li class=nav-item><a class=nav-link href=https://alphapenng.github.io/zh-cn/category/develop/>开发</a></li><li class=nav-item><a class=nav-link href=https://alphapenng.github.io/zh-cn/category/programming/>编程</a></li><li class=nav-item><a class=nav-link href=https://alphapenng.github.io/zh-cn/category/geek/>折腾</a></li><li class=nav-item><a class=nav-link href=https://alphapenng.github.io/en/><i class="fas fa-globe"></i> English</a></li></ul></div></nav></div><div class="container header-wrapper"><div class=row><div class=col-lg-12><div class=header-content><h1 class=header-title>OmniEdge 异地组网部署</h1><p class=header-date>作者:
alphapenng
| <span>1613 字, 4 分钟</span>
| 2022-12-31
| 分类:
<a href=https://alphapenng.github.io/zh-cn/category/geek/>geek</a></p><div class=header-underline></div><div class=clearfix></div><p class="float-right header-tags"><i class="fas fa-tags" aria-hidden=true></i>
<a href=https://alphapenng.github.io/zh-cn/tag/geek/>geek</a>,
<a href=https://alphapenng.github.io/zh-cn/tag/homelab/>homelab</a>,
<a href=https://alphapenng.github.io/zh-cn/tag/omniedge/>omniedge</a>,
<a href=https://alphapenng.github.io/zh-cn/tag/vpn/>vpn</a></p></div></div></div></div></div><main><div class="container content"><article><p><img src=https://alphapenng-1305651397.cos.ap-shanghai.myqcloud.com/uPic/20230101203240_ezEtmN.png alt=toc></p><h2 id=omniedge-是什么>OmniEdge 是什么？</h2><p>打开 OmniEdge的官网 <a href=https://omniedge.io/>https://omniedge.io/</a> 可以看到它的 slogan：</p><blockquote><p><strong>连接任何设备到局域网。</strong>
使用 OmniEdge 的下一代异地组网 Mesh VPN，将局域网架设到网上，将任何地方的任何设备连接到局域网，实现快速的访问。</p></blockquote><p>OmniEdge 的功能其实跟 WireGuard 类似，是一个 VPN 软件，可以实现远程 Mesh 互连, 组建「大」局域网。</p><h2 id=为什么选择-omniedge>为什么选择 OmniEdge？</h2><p>在上一篇博文 <a href=https://alphapenng.github.io/zh-cn/2022/10/10/tailscale-%E5%BC%82%E5%9C%B0%E7%BB%84%E7%BD%91%E5%AE%9E%E8%B7%B5headscale-%E7%9A%84%E9%83%A8%E7%BD%B2%E6%96%B9%E6%B3%95%E5%92%8C%E4%BD%BF%E7%94%A8/>Tailscale 异地组网实践：Headscale 的部署方法和使用</a> 中，我选择通过 Headscale + Tailscale 来组建我的「大」局域网，但在部署完成后测试各节点连通情况时，我发现我的节点之间并没有走直连方式，都是通过中继服务器来达成连接，公共的中继服务器都在国外，通过中继连接等于迂回了路由，效果不理想。虽然可以在国内云服务器上部署私有中继服务器，参考这篇文章 <a href=https://icloudnative.io/posts/custom-derp-servers/>Tailscale 基础教程：部署私有 DERP 中继服务器</a>，但文中提到这种方案实现的前提是需要满足以下几个条件：</p><ul><li>需要准备一台或多台云主机</li><li>要有自己的域名，并且申请了 SSL 证书</li><li>如果服务器在国内，域名需要备案</li></ul><p>云主机我是有一台，在腾讯云上买的轻量应用服务器，享受的新用户首单特惠 88 元一年。</p><p><img src=https://alphapenng-1305651397.cos.ap-shanghai.myqcloud.com/uPic/20230101000839_c4gT7e.png alt=lighthouse-m></p><p>但没有申请域名，想着申请域名要花钱还要备案，就果断放弃了。</p><p>于是我就转向了 OmniEdge，OmniEdge 也可以部署私有中继服务器，在 OmniEdge 中它叫做 Supernode。部署 Supernode 只需要云主机有公网 ip 就行了，另外 OmniEdge 的其他客户端部署也较为容易，只要跟着文档一步一步来就行了。</p><h2 id=supernode-部署>Supernode 部署</h2><ol><li><p>安装 docker 环境</p><p>部署 Supernode 需要云主机有 docker 环境，我的云主机系统是 <code>Ubuntu Jammy 22.04 (LTS)</code>的，可以参考 docker 官方文档，按照 <a href=https://docs.docker.com/engine/install/ubuntu/>Install Docker Engine on Ubuntu</a> 指引，按步骤执行即可，最后通过 <code>sudo docker run hello-world</code> 测试是否安装成功</p></li><li><p>安装 supernode</p><p>只需要执行一条命令即可</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo docker run -d -p 7787:7787/udp omniedge/supernode:latest
</span></span></code></pre></div><p>查看 supernode 是否运行</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo docker container ls
</span></span></code></pre></div><p><img src=https://alphapenng-1305651397.cos.ap-shanghai.myqcloud.com/uPic/20230101005124_K9ryPa.png alt=container_ls></p><p>查看容器日志</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo docker logs -f &lt;container-names&gt;
</span></span></code></pre></div><p><img src=https://alphapenng-1305651397.cos.ap-shanghai.myqcloud.com/uPic/20230101005614_twHYEV.png alt=container_logs></p><p>看到以上日志，就说明 supernode 启动成功了，如果日志有报错，就根据报错再排查。</p></li><li><p>开启云主机防火墙 7787 端口。</p><p>找到云主机防火墙设置页面，在防火墙设置页添加一条规则，以允许云主机开放 udp/7787 端口。</p><p><img src=https://alphapenng-1305651397.cos.ap-shanghai.myqcloud.com/uPic/20230101010035_2bvbGK.png alt=firewall></p></li></ol><p>至此，supernode 就算部署完成了，接着我们根据需要安装客户端。</p><h2 id=安装-omniedge-客户端>安装 OmniEdge 客户端</h2><h3 id=注册-omniedge添加虚拟网络>注册 OmniEdge，添加虚拟网络</h3><p>首先访问 <a href=https://omniedge.io/register>OmniEdge 注册页面</a>，注册用户，然后登录后，点击虚拟网络选项，创建虚拟网络，免费用户只能创建一个虚拟网络，不过对于只组建一个「大」局域网的我来说，已经够了。</p><p><img src=https://alphapenng-1305651397.cos.ap-shanghai.myqcloud.com/uPic/20230101155001_vZc9Wq.png alt=virtual-network></p><h3 id=安装-macos-客户端>安装 macOS 客户端</h3><p>可以参考官方文档 <a href=https://omniedge.io/docs/article/install/macos>Installing on MacOS</a> 进行安装。</p><p>这里我选择安装命令行客户端</p><ol><li><p>安装 Tun/Tap 驱动</p><ul><li><p>下载驱动文件：<a href=https://sourceforge.net/projects/tuntaposx/files/latest/download>https://sourceforge.net/projects/tuntaposx/files/latest/download</a></p></li><li><p>解压 <code>tuntap_20150118.tar.gz</code> 后双击 <code>tuntap_20150118.pkg</code> 进行安装</p></li><li><p>在终端下运行 <code>sudo kextload /Library/Extensions/tap.kext</code></p></li></ul></li><li><p>安装命令行客户端</p><ul><li><p>通过脚本安装：<code>curl https://omniedge.io/install/omniedge-install.sh | bash</code></p></li><li><p>然后在此页面 <a href=https://omniedge.io/dashboard>https://omniedge.io/dashboard</a> 创建安全码</p><p><img src=https://alphapenng-1305651397.cos.ap-shanghai.myqcloud.com/uPic/20230101013508_UYY8u8.png alt=secret-key></p><p><img src=https://alphapenng-1305651397.cos.ap-shanghai.myqcloud.com/uPic/20230101013839_YfQbCn.png alt=create-key></p><p><img src=https://alphapenng-1305651397.cos.ap-shanghai.myqcloud.com/uPic/20230101014146_BzZ8zB.png alt=list-key></p></li><li><p>通过刚才创建的安全码进行登录：<code>omniedge login -s &lt;yoursecuritykey></code></p></li><li><p>加入你创建的虚拟网络：<code>sudo omniedge join</code></p><p><img src=https://alphapenng-1305651397.cos.ap-shanghai.myqcloud.com/uPic/20230101092947_yPzu61.png alt=join_virtual_network></p></li></ul></li></ol><p>至此，macOS 命令行客户端安装完成，接着我们安装 windows 客户端</p><h3 id=安装-windows-客户端>安装 windows 客户端</h3><p>可以参考官方文档 <a href=https://omniedge.io/docs/article/install/windows>Installing on Windows</a> 进行安装。</p><p>windows 客户端安装相对简单。</p><ol><li><p>从 <a href=https://omniedge.io/install/download/0.2.3/omniedge-setup-0.2.3.exe>这里</a> 下载 windows 安装包。下载完成后，双击运行进行安装。</p></li><li><p>右键点击系统托盘上的 OmniEdge 图标，在弹出的菜单中选择“Log in&mldr;”。</p><p><img src=https://alphapenng-1305651397.cos.ap-shanghai.myqcloud.com/uPic/20230101094156_uEDffB.png alt=log_in></p></li><li><p>登录客户端，再次打开系统托盘上的 OmniEdge 菜单，点击“Virtual Networks”，选择所要加入的虚拟网络名，点击“join”加入。</p><p><img src=https://alphapenng-1305651397.cos.ap-shanghai.myqcloud.com/uPic/20230101154006_QIkWSd.png alt=join_virtual_network></p></li><li><p>当获取到虚拟网络IP地址后，即表示连接成功。</p><p><img src=https://alphapenng-1305651397.cos.ap-shanghai.myqcloud.com/uPic/20230101152134_2FrBJr.png alt=connected></p></li></ol><p>至此，windows 客户端安装完成并连接成功，接着我们安装 openwrt 客户端。</p><h3 id=安装-openwrt-客户端>安装 openwrt 客户端</h3><p>待更新。。。</p><h2 id=测试节点连通情况>测试节点连通情况</h2><p>回到 mac，我们打开终端，测试一下与 windows 的连通情况，输入以下命令：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 10.1.0.1 为 windows 客户端的虚拟网络 ip</span>
</span></span><span class=line><span class=cl>gping -4 10.1.0.1
</span></span></code></pre></div><p>gping 是一个图表化 ping 命令的开源工具，可以通过 <a href=https://github.com/orf/gping>https://github.com/orf/gping</a> 下载安装。</p><p><img src=https://alphapenng-1305651397.cos.ap-shanghai.myqcloud.com/uPic/20230101163017_tty.gif alt=omniedge_test></p><p>从测试结果可以看出，最高延时在 158ms，最低延时在 56ms，平均延时稳定在 88ms，效果还是不错的。从我的网络情况来看，两个节点之间应该是通过中继服务器连接的，能达到这种延时不错了，就是不知道直连效果怎样。无论是在客户端还是在 supernode 上，都不知道怎样查看节点之间是直连还是中继的，今后就这样使用再看看稳定性如何。</p></article><h2>相关文章</h2><dl class=row></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl><dt class=col-md-3>2022-12-02</dt><dd class=col-md-9><a href=/zh-cn/2022/12/02/openwrt%E5%BC%80%E5%90%AF802.11k-v-r%E5%8D%8F%E8%AE%AE%E5%AE%9E%E7%8E%B0%E6%89%8B%E6%9C%BA%E5%9C%A8%E8%B7%AF%E7%94%B1%E5%99%A8%E4%B9%8B%E9%97%B4%E6%97%A0%E7%BC%9D%E6%BC%AB%E6%B8%B8/>OpenWrt开启802.11k-v-r协议实现手机在路由器之间无缝漫游</a></dd></dl><dt class=col-md-3>2022-11-21</dt><dd class=col-md-9><a href=/zh-cn/2022/11/21/epon-%E4%B8%8A%E8%A1%8C-e8-c-%E5%AE%B6%E5%BA%AD%E7%BD%91%E5%85%B3%E7%83%BD%E7%81%AB-hg220gs-telecomadmin-%E5%AF%86%E7%A0%81%E8%8E%B7%E5%8F%96%E5%8F%8A%E6%A1%A5%E6%8E%A5%E8%AE%BE%E7%BD%AE/>EPON 上行 E8 C 家庭网关（烽火 HG220GS） telecomadmin 密码获取及桥接设置</a></dd></dl><dt class=col-md-3>2022-10-10</dt><dd class=col-md-9><a href=/zh-cn/2022/10/10/tailscale-%E5%BC%82%E5%9C%B0%E7%BB%84%E7%BD%91%E5%AE%9E%E8%B7%B5headscale-%E7%9A%84%E9%83%A8%E7%BD%B2%E6%96%B9%E6%B3%95%E5%92%8C%E4%BD%BF%E7%94%A8/>Tailscale 异地组网实践：Headscale 的部署方法和使用</a></dd></dl></dl><dt class=col-md-3>2022-10-06</dt><dd class=col-md-9><a href=/zh-cn/2022/10/06/%E7%BA%A2%E7%B1%B3-ax6-%E8%A7%A3%E9%94%81-ssh-%E5%88%B7%E6%9C%BA-openwrt-%E6%95%99%E7%A8%8B/>红米 AX6 解锁 SSH 安装 ShellClash 及刷机 Openwrt 教程</a></dd></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl></dl><div align=center><div class=comment-underline></div></div><br><div id=cusdis_thread data-host=https://cusdis.com data-app-id=34a447f4-be9d-4312-b87b-2c5bfcfc7658 data-page-id=dd2c36f408eba166e302e7001b28a9d9 data-page-url=https://alphapenng.github.io/zh-cn/2022/12/31/omniedge-%E5%BC%82%E5%9C%B0%E7%BB%84%E7%BD%91%E9%83%A8%E7%BD%B2/ data-page-title="OmniEdge 异地组网部署"></div><script defer src=https://cusdis.com/js/widget/lang/zh-cn.js></script>
<script async defer src=https://cusdis.com/js/cusdis.es.js></script></div></main><div class="footer gradient-2"><div class="container footer-container"><div class=row><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"><div class=footer-title>网站地图</div><ul class=list-unstyled><li><a href=https://alphapenng.github.io/zh-cn/tags/>标签</a></li><li><a href=https://alphapenng.github.io/zh-cn/categories/>分类</a></li><li><a rel=alternate type=application/rss+xml href=https://alphapenng.github.io/zh-cn/index.xml><i class="fas fa-rss-square"></i> RSS</a></li></ul></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"></div><div class="col-xs-4 col-sm-3 col-md-3 col-lg-3"></div><div class="col-xs-12 col-sm-3 col-md-3 col-lg-3"><p class="pull-right text-right"><small><em>Powered by <a href=https://gohugo.io rel=noopener target=_blank>Hugo</a> - <a href=https://github.com/shaform/hugo-theme-den rel=noopener target=_blank>den</a></em></small><br><small>&copy;
alphapenng
2022 -
2023</small></p></div></div></div></div><script src=https://code.jquery.com/jquery-3.3.1.slim.min.js integrity=sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script></body></html>